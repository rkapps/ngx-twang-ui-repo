<div class="w-full">
    @for (node of nodes(); track node.id) {
    <div class="p-2 px-4 hover:border-1 hover:border-gray-50 rounded-md hover:bg-gray-100 focus:ring-gray-100"
        (click)="onNodeClick(node)">
        <div [style.padding-left.px]="level() * 16" class="flex flex-row items-center w-full"
            (click)="onToggleSelection(node)">

            <div class="flex flex-row w-full">

                <!-- Conditional Checkbox for Select mode -->
                @if (mode() === 'checkbox') {
                <span class="pr-2">
                    <input type="checkbox" [checked]="isSelected(node)" (change)="onCheck(node)">
                </span>
                }

                <!-- Icon Support -->
                @if (node.icon) {
                <span class="pr-2">
                    <lucide-icon size="18" [name]="node.icon"></lucide-icon>
                </span>
                }

                <!-- Content Projection for the Label (allows routerLink or just text) -->
                <span [ngClass]="{'text-slate-900' : !isSelected(node),  'text-accent-700' : isSelected(node)}">
                    {{ node.label }}
                </span>
            </div>

            <div class="justify-end">
                @if (node.children?.length) {
                @if(node.expanded) {
                <twang-button size="xs" variant="default" icon="ArrowDown"></twang-button>
                } @else {
                <twang-button size="xs" variant="default" icon="ArrowRight"></twang-button>
                }
                }
            </div>
        </div>
    </div>

    @if (node.expanded && node.children) {
    <twang-tree-view [nodes]="node.children" [mode]="mode()" [level]="level() + 1" (nodeClick)="onNodeClick($event)">
    </twang-tree-view>
    }
    }
</div>